# æ™ºç¼–åŠ©æ‰‹ SmartEdit AI - å¼€å‘æ–‡æ¡£

> ç‰ˆæœ¬ï¼šv1.0.0 | æ›´æ–°æ—¥æœŸï¼š2025å¹´12æœˆ

## ç›®å½•

1. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [å¼€å‘ç¯å¢ƒ](#å¼€å‘ç¯å¢ƒ)
4. [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
5. [API æ¥å£](#api-æ¥å£)
6. [æ•°æ®å­˜å‚¨](#æ•°æ®å­˜å‚¨)
7. [æ‰©å±•å¼€å‘](#æ‰©å±•å¼€å‘)
8. [æ„å»ºéƒ¨ç½²](#æ„å»ºéƒ¨ç½²)

---

## æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | è¯´æ˜ |
|------|------|------|
| æ‰©å±•æ ‡å‡† | Chrome Manifest V3 | æœ€æ–°æ‰©å±•æ ‡å‡† |
| å‰ç«¯æ¡†æ¶ | React 18 | ç»„ä»¶åŒ–å¼€å‘ |
| ç±»å‹ç³»ç»Ÿ | TypeScript | ç±»å‹å®‰å…¨ |
| æ ·å¼æ–¹æ¡ˆ | TailwindCSS | åŸå­åŒ– CSS |
| æ„å»ºå·¥å…· | Vite | å¿«é€Ÿæ„å»º |
| çŠ¶æ€ç®¡ç† | Zustand | è½»é‡çŠ¶æ€ç®¡ç† |
| æœ¬åœ°å­˜å‚¨ | IndexedDB (idb) | ç»“æ„åŒ–å­˜å‚¨ |

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Chrome Extension                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Popup  â”‚  â”‚ Options â”‚  â”‚ Content â”‚  â”‚Backgroundâ”‚   â”‚
â”‚  â”‚  é¡µé¢   â”‚  â”‚  è®¾ç½®   â”‚  â”‚ Script  â”‚  â”‚ Service  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚            â”‚            â”‚            â”‚          â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                          â”‚                               â”‚
â”‚                 Chrome Storage API                       â”‚
â”‚                 Chrome Runtime API                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    External APIs                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ OpenAI  â”‚  â”‚Unsplash â”‚  â”‚ Tavily  â”‚  â”‚Obsidian â”‚   â”‚
â”‚  â”‚   API   â”‚  â”‚   API   â”‚  â”‚   API   â”‚  â”‚REST API â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

```
ç”¨æˆ·æ“ä½œ â†’ Content Script â†’ Background Service Worker â†’ External API
                â†“                      â†“
           IndexedDB              Chrome Storage
           (æœ¬åœ°æ•°æ®)              (è®¾ç½®åŒæ­¥)
```

---

## é¡¹ç›®ç»“æ„

```
EditorHelper/
â”œâ”€â”€ dist/                    # æ„å»ºè¾“å‡ºç›®å½•
â”œâ”€â”€ docs/                    # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ äº§å“åŠŸèƒ½è¯´æ˜.md
â”‚   â”œâ”€â”€ ç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ.md
â”‚   â””â”€â”€ å¼€å‘æ–‡æ¡£.md
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ background/          # Service Worker
â”‚   â”‚   â””â”€â”€ index.ts         # åå°æœåŠ¡å…¥å£
â”‚   â”œâ”€â”€ content/             # Content Script
â”‚   â”‚   â”œâ”€â”€ components/      # React ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ AIWritingPanel.tsx    # AI å†™ä½œé¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ ImagePanel.tsx        # é…å›¾é¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ MarkdownPanel.tsx     # Markdown é¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ RSSPanel.tsx          # RSS é¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ StoragePanel.tsx      # å­˜å‚¨é¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ TemplatePanel.tsx     # æ¨¡æ¿é¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ ToolPanel.tsx         # å·¥å…·é¢æ¿
â”‚   â”‚   â”‚   â””â”€â”€ index.ts              # ç»„ä»¶å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ styles/          # æ ·å¼æ¨¡æ¿æ•°æ®
â”‚   â”‚   â”œâ”€â”€ constants.ts     # å¸¸é‡å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ index.tsx        # Content Script å…¥å£
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx      # ä¾§è¾¹æ ä¸»ç»„ä»¶
â”‚   â”‚   â””â”€â”€ utils.ts         # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ lib/                 # å…¬å…±åº“
â”‚   â”‚   â”œâ”€â”€ obsidian.ts      # Obsidian API å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ storage.ts       # IndexedDB å­˜å‚¨
â”‚   â”œâ”€â”€ options/             # è®¾ç½®é¡µé¢
â”‚   â”‚   â”œâ”€â”€ App.tsx          # è®¾ç½®é¡µé¢ç»„ä»¶
â”‚   â”‚   â””â”€â”€ index.tsx        # å…¥å£
â”‚   â””â”€â”€ popup/               # å¼¹å‡ºé¡µé¢
â”‚       â”œâ”€â”€ App.tsx          # å¼¹å‡ºé¡µé¢ç»„ä»¶
â”‚       â””â”€â”€ index.tsx        # å…¥å£
â”œâ”€â”€ assets/                  # é™æ€èµ„æº
â”‚   â””â”€â”€ icons/               # æ‰©å±•å›¾æ ‡
â”œâ”€â”€ scripts/                 # æ„å»ºè„šæœ¬
â”‚   â”œâ”€â”€ build.js             # æ‰“åŒ…è„šæœ¬
â”‚   â””â”€â”€ generate-icons.js    # å›¾æ ‡ç”Ÿæˆ
â”œâ”€â”€ manifest.json            # æ‰©å±•é…ç½®
â”œâ”€â”€ package.json             # é¡¹ç›®é…ç½®
â”œâ”€â”€ tsconfig.json            # TypeScript é…ç½®
â”œâ”€â”€ tailwind.config.js       # TailwindCSS é…ç½®
â”œâ”€â”€ vite.config.ts           # Vite ä¸»é…ç½®
â””â”€â”€ vite.content.config.ts   # Content Script æ„å»ºé…ç½®
```

---

## å¼€å‘ç¯å¢ƒ

### ç¯å¢ƒè¦æ±‚

- **Node.js**: v20.19.4+
- **npm**: v10.8.2+
- **Chrome**: 88+

### å®‰è£…ä¾èµ–

```bash
npm install
```

### å¼€å‘å‘½ä»¤

```bash
# å¯åŠ¨å¼€å‘æ¨¡å¼ï¼ˆç›‘å¬æ–‡ä»¶å˜åŒ–ï¼‰
npm run dev

# ä»…æ„å»ºä¸»ç¨‹åº
npm run dev:main

# ä»…æ„å»º Content Script
npm run dev:content

# å®Œæ•´æ„å»º
npm run build

# ç”Ÿæˆå›¾æ ‡
npm run icons

# æ‰“åŒ… zip
npm run zip
```

### è°ƒè¯•æ–¹æ³•

#### 1. åŠ è½½æ‰©å±•

1. è®¿é—® `chrome://extensions/`
2. å¼€å¯ã€Œå¼€å‘è€…æ¨¡å¼ã€
3. ç‚¹å‡»ã€ŒåŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºã€
4. é€‰æ‹© `dist` ç›®å½•

#### 2. Content Script è°ƒè¯•

1. åœ¨ç›®æ ‡é¡µé¢ï¼ˆå¾®ä¿¡å…¬ä¼—å·ç¼–è¾‘é¡µï¼‰æŒ‰ F12
2. åœ¨ Sources é¢æ¿æ‰¾åˆ° `content.js`
3. è®¾ç½®æ–­ç‚¹è°ƒè¯•

#### 3. Background è°ƒè¯•

1. åœ¨ `chrome://extensions/` æ‰¾åˆ°æ‰©å±•
2. ç‚¹å‡»ã€ŒService Workerã€é“¾æ¥
3. æ‰“å¼€ DevTools è°ƒè¯•

#### 4. Popup/Options è°ƒè¯•

1. å³é”®ç‚¹å‡»æ‰©å±•å›¾æ ‡æˆ–è®¾ç½®é¡µé¢
2. é€‰æ‹©ã€Œæ£€æŸ¥ã€æ‰“å¼€ DevTools

---

## æ ¸å¿ƒæ¨¡å—

### 1. Background Service Worker

**æ–‡ä»¶**: `src/background/index.ts`

**èŒè´£**:
- å¤„ç† AI API è¯·æ±‚
- å¤„ç†å›¾ç‰‡æœç´¢è¯·æ±‚
- å¤„ç† RSS è·å–
- ç®¡ç†æ‰©å±•ç”Ÿå‘½å‘¨æœŸ

**æ¶ˆæ¯ç±»å‹**:

```typescript
interface Message {
  type: 'AI_REQUEST' | 'SEARCH_IMAGES' | 'TAVILY_SEARCH' | 
        'FETCH_RSS' | 'GET_SETTINGS'
  data: any
}
```

**ç¤ºä¾‹ - AI è¯·æ±‚å¤„ç†**:

```typescript
case 'AI_REQUEST':
  const result = await handleAIRequest(message.data)
  sendResponse({ success: true, data: result })
  break
```

### 2. Content Script ç»„ä»¶

#### Sidebar.tsx - ä¾§è¾¹æ ä¸»ç»„ä»¶

```typescript
interface SidebarProps {
  themeColor: string
  onClose: () => void
}

// å¯¼èˆªé¡¹
const NAV_ITEMS = [
  { id: 'template', icon: 'ğŸ“', label: 'æ’ç‰ˆ' },
  { id: 'markdown', icon: 'ğŸ“‹', label: 'MD' },
  { id: 'ai', icon: 'âœ¨', label: 'å†™ä½œ' },
  { id: 'rss', icon: 'ğŸ“°', label: 'RSS' },
  { id: 'storage', icon: 'ğŸ’¾', label: 'å­˜å‚¨' },
  { id: 'image', icon: 'ğŸ–¼ï¸', label: 'é…å›¾' },
  { id: 'tool', icon: 'ğŸ”§', label: 'å·¥å…·' },
]
```

#### AIWritingPanel.tsx - AI å†™ä½œé¢æ¿

**åŠŸèƒ½æ¨¡å—**:
- æ ‡é¢˜ç”Ÿæˆ
- æ ‡é¢˜è¯„åˆ†
- æ–‡ç« ç”Ÿæˆ
- åˆ’è¯æ”¹å†™

**æ ¸å¿ƒå‡½æ•°**:

```typescript
// ç”Ÿæˆæ ‡é¢˜
const generateTitles = async (content: string) => {
  const response = await chrome.runtime.sendMessage({
    type: 'AI_REQUEST',
    data: { action: 'generateTitles', content }
  })
  return response.data.titles
}

// è¯„åˆ†æ ‡é¢˜
const scoreTitle = async (title: string) => {
  const response = await chrome.runtime.sendMessage({
    type: 'AI_REQUEST',
    data: { action: 'scoreTitle', title }
  })
  return response.data
}
```

#### StoragePanel.tsx - å­˜å‚¨é¢æ¿

**åŠŸèƒ½**:
- è‰ç¨¿ç®¡ç†
- æ”¶è—ç®¡ç†
- æ•°æ®å¯¼å‡º
- Obsidian åŒæ­¥

**çŠ¶æ€ç®¡ç†**:

```typescript
const [drafts, setDrafts] = useState<Draft[]>([])
const [collections, setCollections] = useState<Collection[]>([])
const [obsidianConfig, setObsidianConfig] = useState<ObsidianConfig | null>(null)
const [obsidianStatus, setObsidianStatus] = useState<'unknown' | 'connected' | 'disconnected'>('unknown')
```

### 3. å­˜å‚¨æ¨¡å—

**æ–‡ä»¶**: `src/lib/storage.ts`

**æ•°æ®åº“ç»“æ„**:

```typescript
interface EditorHelperDB extends DBSchema {
  drafts: {
    key: string
    value: Draft
    indexes: { 'by-updated': string }
  }
  collections: {
    key: string
    value: Collection
    indexes: { 'by-type': string; 'by-created': string }
  }
  history: {
    key: string
    value: HistoryItem
    indexes: { 'by-date': string }
  }
}
```

**æ ¸å¿ƒæ¥å£**:

```typescript
// è‰ç¨¿
interface Draft {
  id: string
  title: string
  content: string
  htmlContent?: string
  tags: string[]
  createdAt: string
  updatedAt: string
}

// æ”¶è—
interface Collection {
  id: string
  type: 'article' | 'image' | 'title' | 'quote' | 'template'
  title: string
  content: string
  source?: string
  sourceUrl?: string
  tags: string[]
  createdAt: string
}
```

**å¯¼å‡ºå‡½æ•°**:

```typescript
// CRUD æ“ä½œ
export async function saveDraft(draft: Omit<Draft, 'id' | 'createdAt' | 'updatedAt'>): Promise<string>
export async function getDraft(id: string): Promise<Draft | undefined>
export async function getAllDrafts(): Promise<Draft[]>
export async function deleteDraft(id: string): Promise<void>

// å¯¼å…¥å¯¼å‡º
export async function exportAllData(): Promise<ExportData>
export async function importData(data: ExportData): Promise<void>

// Markdown è½¬æ¢
export function draftToMarkdown(draft: Draft): string
export function collectionToMarkdown(collection: Collection): string
```

### 4. Obsidian å®¢æˆ·ç«¯

**æ–‡ä»¶**: `src/lib/obsidian.ts`

**é…ç½®æ¥å£**:

```typescript
export interface ObsidianConfig {
  enabled: boolean
  apiUrl: string      // é»˜è®¤: https://localhost:27124
  apiKey: string
  defaultPath: string // é»˜è®¤: å…¬ä¼—å·
  autoSync: boolean
}
```

**å®¢æˆ·ç«¯ç±»**:

```typescript
export class ObsidianClient {
  constructor(config: ObsidianConfig)
  
  // æµ‹è¯•è¿æ¥
  async testConnection(): Promise<ConnectionStatus>
  
  // ä¿å­˜ç¬”è®°
  async saveNote(path: string, content: string): Promise<SaveResult>
  
  // è·å–ç¬”è®°
  async getNote(path: string): Promise<NoteContent>
  
  // åˆ—å‡ºæ–‡ä»¶
  async listFiles(path?: string): Promise<FileList>
  
  // æœç´¢
  async search(query: string): Promise<SearchResult[]>
  
  // è¿½åŠ å†…å®¹
  async appendToNote(path: string, content: string): Promise<SaveResult>
  
  // åˆ é™¤ç¬”è®°
  async deleteNote(path: string): Promise<DeleteResult>
}
```

**æ ¼å¼åŒ–å‡½æ•°**:

```typescript
export function formatAsObsidianNote(
  title: string, 
  content: string, 
  metadata?: NoteMetadata
): string
```

**è¾“å‡ºç¤ºä¾‹**:

```markdown
---
title: æ–‡ç« æ ‡é¢˜
created: 2025-12-09T10:00:00.000Z
type: draft
source: RSSè®¢é˜…
sourceUrl: https://example.com/article
tags:
  - å…¬ä¼—å·
  - è‰ç¨¿
---

# æ–‡ç« æ ‡é¢˜

æ–‡ç« å†…å®¹...

---
> æ¥æº: [[RSSè®¢é˜…]]
> é“¾æ¥: https://example.com/article
```

---

## API æ¥å£

### AI æœåŠ¡æ¥å£

**æ”¯æŒçš„æä¾›å•†**:

```typescript
export const AI_PROVIDERS: Record<string, { baseUrl: string; defaultModel: string }> = {
  openai: { baseUrl: 'https://api.openai.com/v1', defaultModel: 'gpt-3.5-turbo' },
  deepseek: { baseUrl: 'https://api.deepseek.com/v1', defaultModel: 'deepseek-chat' },
  aliyun: { baseUrl: 'https://dashscope.aliyuncs.com/compatible-mode/v1', defaultModel: 'qwen-plus' },
  siliconflow: { baseUrl: 'https://api.siliconflow.cn/v1', defaultModel: 'Qwen/Qwen2.5-7B-Instruct' },
  moonshot: { baseUrl: 'https://api.moonshot.cn/v1', defaultModel: 'moonshot-v1-8k' },
  zhipu: { baseUrl: 'https://open.bigmodel.cn/api/paas/v4', defaultModel: 'glm-4-flash' },
  custom: { baseUrl: '', defaultModel: '' }
}
```

**è¯·æ±‚æ ¼å¼** (OpenAI å…¼å®¹):

```typescript
const response = await fetch(`${baseUrl}/chat/completions`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${apiKey}`
  },
  body: JSON.stringify({
    model: model,
    messages: [
      { role: 'system', content: systemPrompt },
      { role: 'user', content: userPrompt }
    ],
    temperature: 0.7
  })
})
```

### å›¾ç‰‡æœåŠ¡æ¥å£

#### Unsplash API

```typescript
const searchImages = async (query: string, page: number = 1) => {
  const response = await fetch(
    `https://api.unsplash.com/search/photos?query=${query}&page=${page}&per_page=20`,
    {
      headers: {
        'Authorization': `Client-ID ${unsplashKey}`
      }
    }
  )
  return response.json()
}
```

#### Pixabay API

```typescript
const searchImages = async (query: string, page: number = 1) => {
  const response = await fetch(
    `https://pixabay.com/api/?key=${pixabayKey}&q=${query}&page=${page}&per_page=20`
  )
  return response.json()
}
```

### Obsidian REST API

**åŸºç¡€ URL**: `https://localhost:27124`

**è®¤è¯**: Bearer Token

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/` | GET | è·å– Vault ä¿¡æ¯ |
| `/vault/{path}` | GET | è·å–ç¬”è®°å†…å®¹ |
| `/vault/{path}` | PUT | åˆ›å»º/æ›´æ–°ç¬”è®° |
| `/vault/{path}` | POST | è¿½åŠ å†…å®¹ |
| `/vault/{path}` | DELETE | åˆ é™¤ç¬”è®° |
| `/vault/` | GET | åˆ—å‡ºæ–‡ä»¶ |
| `/search/simple/` | POST | ç®€å•æœç´¢ |

---

## æ•°æ®å­˜å‚¨

### Chrome Storage

**ç”¨é€”**: å­˜å‚¨ç”¨æˆ·è®¾ç½®ï¼ˆè·¨è®¾å¤‡åŒæ­¥ï¼‰

**æ•°æ®ç»“æ„**:

```typescript
interface Settings {
  themeColor: string
  showFloatingToolbar: boolean
  autoInsertStyle: boolean
  showSelectionToolbar: boolean
  aiProvider: string
  apiKey: string
  customBaseUrl: string
  customModel: string
  unsplashKey: string
  pixabayKey: string
  tavilyKey: string
  proxyEnabled: boolean
  proxyUrl: string
  proxyType: 'http' | 'socks5' | 'custom'
  rssFeeds: RSSFeed[]
  rssRefreshInterval: number
  obsidian: ObsidianConfig
}
```

**ä½¿ç”¨æ–¹å¼**:

```typescript
// è¯»å–è®¾ç½®
chrome.storage.sync.get(['settings'], (result) => {
  const settings = result.settings || defaultSettings
})

// ä¿å­˜è®¾ç½®
chrome.storage.sync.set({ settings })
```

### IndexedDB

**ç”¨é€”**: å­˜å‚¨è‰ç¨¿ã€æ”¶è—ç­‰å¤§é‡æœ¬åœ°æ•°æ®

**æ•°æ®åº“å**: `editor-helper-db`

**ç‰ˆæœ¬**: 1

**å­˜å‚¨è¡¨**:

| è¡¨å | ä¸»é”® | ç´¢å¼• | è¯´æ˜ |
|------|------|------|------|
| drafts | id | by-updated | è‰ç¨¿ |
| collections | id | by-type, by-created | æ”¶è— |
| history | id | by-date | å†å²è®°å½• |

---

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„ AI æä¾›å•†

1. åœ¨ `src/content/constants.ts` æ·»åŠ é…ç½®:

```typescript
export const AI_PROVIDERS = {
  // ... ç°æœ‰é…ç½®
  newProvider: { 
    baseUrl: 'https://api.newprovider.com/v1', 
    defaultModel: 'model-name' 
  }
}
```

2. åœ¨ `src/options/App.tsx` æ·»åŠ é€‰é¡¹:

```typescript
const providerOptions = [
  // ... ç°æœ‰é€‰é¡¹
  { value: 'newProvider', label: 'æ–°æä¾›å•†' }
]
```

### æ·»åŠ æ–°çš„æ ·å¼æ¨¡æ¿

åœ¨ `src/content/constants.ts` çš„ `STYLE_TEMPLATES` ä¸­æ·»åŠ :

```typescript
export const STYLE_TEMPLATES = {
  titles: [
    // ... ç°æœ‰æ ·å¼
    { 
      name: 'æ–°æ ‡é¢˜æ ·å¼', 
      preview: 'é¢„è§ˆæ–‡å­—', 
      html: '<section>HTML ä»£ç </section>' 
    }
  ]
}
```

### æ·»åŠ æ–°çš„ä¾§è¾¹æ é¢æ¿

1. åˆ›å»ºç»„ä»¶æ–‡ä»¶ `src/content/components/NewPanel.tsx`:

```typescript
interface NewPanelProps {
  themeColor: string
}

export default function NewPanel({ themeColor }: NewPanelProps) {
  return (
    <div className="p-4">
      {/* é¢æ¿å†…å®¹ */}
    </div>
  )
}
```

2. åœ¨ `src/content/components/index.ts` å¯¼å‡º:

```typescript
export { default as NewPanel } from './NewPanel'
```

3. åœ¨ `src/content/constants.ts` æ·»åŠ å¯¼èˆªé¡¹:

```typescript
export const NAV_ITEMS = [
  // ... ç°æœ‰é¡¹
  { id: 'new', icon: 'ğŸ†•', label: 'æ–°åŠŸèƒ½' }
]
```

4. åœ¨ `src/content/Sidebar.tsx` æ·»åŠ æ¸²æŸ“:

```typescript
{activeNav === 'new' && (
  <NewPanel themeColor={themeColor} />
)}
```

### æ·»åŠ æ–°çš„æ¶ˆæ¯ç±»å‹

1. åœ¨ `src/background/index.ts` æ·»åŠ å¤„ç†:

```typescript
case 'NEW_MESSAGE_TYPE':
  const result = await handleNewMessage(message.data)
  sendResponse({ success: true, data: result })
  break
```

2. åœ¨ç»„ä»¶ä¸­å‘é€æ¶ˆæ¯:

```typescript
const response = await chrome.runtime.sendMessage({
  type: 'NEW_MESSAGE_TYPE',
  data: { /* æ•°æ® */ }
})
```

---

## æ„å»ºéƒ¨ç½²

### å¼€å‘æ„å»º

```bash
npm run dev
```

- å¯åŠ¨ Vite watch æ¨¡å¼
- è‡ªåŠ¨ç›‘å¬æ–‡ä»¶å˜åŒ–
- è¾“å‡ºåˆ° `dist` ç›®å½•

### ç”Ÿäº§æ„å»º

```bash
npm run build
```

- TypeScript ç±»å‹æ£€æŸ¥
- ä»£ç å‹ç¼©ä¼˜åŒ–
- è¾“å‡ºåˆ° `dist` ç›®å½•

### æ‰“åŒ…å‘å¸ƒ

```bash
npm run zip
```

- ç”Ÿæˆ `smartedit-ai-v{version}.zip`
- å¯ç›´æ¥ä¸Šä¼ åˆ° Chrome Web Store

### æ„å»ºé…ç½®

**Vite ä¸»é…ç½®** (`vite.config.ts`):

```typescript
export default defineConfig({
  plugins: [react()],
  build: {
    outDir: 'dist',
    rollupOptions: {
      input: {
        popup: 'src/popup/index.html',
        options: 'src/options/index.html',
        background: 'src/background/index.ts'
      },
      output: {
        entryFileNames: '[name]/[name].js'
      }
    }
  }
})
```

**Content Script é…ç½®** (`vite.content.config.ts`):

```typescript
export default defineConfig({
  plugins: [react()],
  build: {
    outDir: 'dist',
    lib: {
      entry: 'src/content/index.tsx',
      name: 'content',
      fileName: 'content/content',
      formats: ['iife']
    }
  }
})
```

---

## ä»£ç è§„èŒƒ

### TypeScript è§„èŒƒ

- ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼
- æ‰€æœ‰å‡½æ•°å‚æ•°å’Œè¿”å›å€¼å¿…é¡»æœ‰ç±»å‹
- ä½¿ç”¨ interface å®šä¹‰æ•°æ®ç»“æ„
- é¿å…ä½¿ç”¨ any

### React è§„èŒƒ

- ä½¿ç”¨å‡½æ•°ç»„ä»¶ + Hooks
- ç»„ä»¶æ–‡ä»¶ä½¿ç”¨ PascalCase
- Props æ¥å£ä»¥ Props ç»“å°¾
- ä½¿ç”¨ useState/useEffect ç®¡ç†çŠ¶æ€

### æ ·å¼è§„èŒƒ

- ä½¿ç”¨ TailwindCSS ç±»å
- é¿å…å†…è”æ ·å¼
- ä¸»é¢˜è‰²ä½¿ç”¨ CSS å˜é‡æˆ– props ä¼ é€’

### Git æäº¤è§„èŒƒ

```
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤ bug
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼
refactor: é‡æ„
test: æµ‹è¯•
chore: æ„å»º/å·¥å…·
```

---

## å¸¸è§é—®é¢˜

### Q: Content Script ä¸ç”Ÿæ•ˆï¼Ÿ

æ£€æŸ¥ `manifest.json` çš„ `content_scripts` é…ç½®:

```json
{
  "content_scripts": [{
    "matches": ["https://mp.weixin.qq.com/*"],
    "js": ["content/content.js"],
    "css": ["content/style.css"]
  }]
}
```

### Q: Background æ— æ³•æ¥æ”¶æ¶ˆæ¯ï¼Ÿ

ç¡®ä¿ä½¿ç”¨ `chrome.runtime.sendMessage` å¹¶æ­£ç¡®å¤„ç†å¼‚æ­¥å“åº”:

```typescript
// å‘é€ç«¯
const response = await chrome.runtime.sendMessage({ type: 'TEST' })

// æ¥æ”¶ç«¯
chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
  // å¿…é¡»è¿”å› true ä»¥æ”¯æŒå¼‚æ­¥å“åº”
  handleMessage(message).then(sendResponse)
  return true
})
```

### Q: IndexedDB æ“ä½œå¤±è´¥ï¼Ÿ

ç¡®ä¿æ•°æ®åº“å·²åˆå§‹åŒ–:

```typescript
import { initDB } from '../lib/storage'

// åœ¨ä½¿ç”¨å‰åˆå§‹åŒ–
await initDB()
```

---

## å‚è€ƒèµ„æº

- [Chrome Extension Manifest V3](https://developer.chrome.com/docs/extensions/mv3/)
- [React æ–‡æ¡£](https://react.dev/)
- [Vite æ–‡æ¡£](https://vitejs.dev/)
- [TailwindCSS æ–‡æ¡£](https://tailwindcss.com/)
- [idb åº“æ–‡æ¡£](https://github.com/jakearchibald/idb)
- [Obsidian Local REST API](https://github.com/coddingtonbear/obsidian-local-rest-api)
